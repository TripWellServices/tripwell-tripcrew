datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Traveler {
  id                String           @id @default(uuid())
  firebaseId         String?          @unique
  email              String?          @unique
  firstName          String?
  lastName           String?
  photoUrl           String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  
  // TripCrew Relations (matching GoFast RunCrew pattern)
  tripCrewMemberships TripCrewMember[] @relation("TravelerTripCrewMemberships")
  tripCrewRoles       TripCrewRole[]   @relation("TravelerTripCrewRoles")
}

model TripCrew {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations (matching GoFast RunCrew pattern)
  memberships TripCrewMember[] // Junction table for members
  roles       TripCrewRole[]   // Junction table for admin/manager roles
  trips       Trip[]           // Trips belong to TripCrew
}

model Trip {
  id          String         @id @default(uuid())
  tripCrewId  String         // Required: trip belongs to a TripCrew
  name        String
  destination String?
  startDate   DateTime?
  endDate     DateTime?
  coverImage  String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  
  // Relations
  tripCrew    TripCrew       @relation(fields: [tripCrewId], references: [id], onDelete: Cascade)
  lodging     Lodging?
  dining      Dining[]
  attractions Attraction[]
  logistics   LogisticItem[]
  packItems   PackItem[]
}

model Lodging {
  id            String  @id @default(uuid())
  tripId        String  @unique
  title         String
  address       String?
  website       String?
  phone         String?
  googlePlaceId String?
  imageUrl      String?
  rating        Float?
  lat           Float?
  lng           Float?
  trip          Trip    @relation(fields: [tripId], references: [id])
}

model Dining {
  id                  String    @id @default(uuid())
  tripId              String
  title               String
  category            String?
  address             String?
  phone               String?
  website             String?
  googlePlaceId       String?   @unique
  imageUrl            String?
  rating              Float?
  lat                 Float?
  lng                 Float?
  distanceFromLodging Float?
  driveTimeMinutes    Int?
  itineraryDay        DateTime?
  trip                Trip      @relation(fields: [tripId], references: [id])
}

model Attraction {
  id                  String    @id @default(uuid())
  tripId              String
  title               String
  category            String?
  address             String?
  phone               String?
  website             String?
  googlePlaceId       String?   @unique
  imageUrl            String?
  rating              Float?
  lat                 Float?
  lng                 Float?
  distanceFromLodging Float?
  driveTimeMinutes    Int?
  itineraryDay        DateTime?
  trip                Trip      @relation(fields: [tripId], references: [id])
}

model LogisticItem {
  id         String  @id @default(uuid())
  tripId     String
  title      String
  detail     String?
  isComplete Boolean @default(false)
  trip       Trip    @relation(fields: [tripId], references: [id])
}

model PackItem {
  id       String  @id @default(uuid())
  tripId   String
  title    String
  isPacked Boolean @default(false)
  trip     Trip    @relation(fields: [tripId], references: [id])
}

// TripCrew Membership - Junction table (matching GoFast RunCrewMembership pattern)
model TripCrewMember {
  id         String   @id @default(uuid())
  tripCrewId String
  travelerId String   // ATHLETE-FIRST: Foreign key to Traveler

  // Timestamps
  joinedAt   DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  tripCrew TripCrew @relation(fields: [tripCrewId], references: [id], onDelete: Cascade)
  traveler Traveler @relation("TravelerTripCrewMemberships", fields: [travelerId], references: [id], onDelete: Cascade)

  @@unique([tripCrewId, travelerId]) // Prevent duplicate memberships
  @@map("trip_crew_members")
}

// TripCrew Roles - Junction table for admin/manager roles (matching GoFast RunCrewManager pattern)
model TripCrewRole {
  id         String   @id @default(uuid())
  tripCrewId String
  travelerId String
  role       String   // "admin" | "manager"

  createdAt  DateTime @default(now())

  // Relations
  tripCrew TripCrew @relation(fields: [tripCrewId], references: [id], onDelete: Cascade)
  traveler Traveler @relation("TravelerTripCrewRoles", fields: [travelerId], references: [id], onDelete: Cascade)

  @@unique([tripCrewId, travelerId])
  @@map("trip_crew_roles")
}
